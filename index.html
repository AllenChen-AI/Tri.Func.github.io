<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰è§’å‡½æ•¸å¤§å¸«ï¼šé—–é—œæŒ‘æˆ°</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ KaTeX ç”¨æ–¼é¡¯ç¤º LaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Microsoft JhengHei, sans-serif;
            overflow-x: hidden;
        }
        .btn-option:active {
            transform: scale(0.95);
        }
        .katex {
            font-size: 1.1em;
        }
        
        /* ç‚¸å½ˆå‹•ç•« */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake-hard {
            animation: shake 0.5s;
            animation-iteration-count: infinite;
        }
        
        /* çˆ†ç‚¸å‹•ç•« */
        @keyframes explode {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(3); opacity: 0.8; }
            100% { transform: scale(5); opacity: 0; }
        }
        .explosion-effect {
            animation: explode 0.5s forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- Components ---
        
        const Latex = ({ children, className = "", displayMode = false }) => {
            const containerRef = React.useRef(null);
            React.useEffect(() => {
                if (window.katex && containerRef.current) {
                    window.katex.render(children, containerRef.current, {
                        throwOnError: false,
                        displayMode: displayMode
                    });
                }
            }, [children, displayMode]);
            return <span ref={containerRef} className={className} />;
        };

        // --- Game Icons (SVG) ---
        
        const GameBadge = ({ level, className = "w-16 h-16" }) => {
            // å®šç¾©é¡è‰²èˆ‡æ¨£å¼
            // Lv 1-3: æˆ’æŒ‡ (éŠ…/éŠ€/é‡‘)
            // Lv 4: æˆ’æŒ‡ (ç™½é‡‘)
            // Lv 5-7: å¯¶çŸ³æˆ’æŒ‡ (ç¿¡ç¿ /ç´…å¯¶/è—é‘½)
            // Lv 8: çç›ƒ
            // Lv 9: çš‡å† 

            const getColors = (lvl) => {
                switch(lvl) {
                    case 1: return { main: "#CD7F32", dark: "#8B4513", light: "#E6A86F" }; // éŠ…
                    case 2: return { main: "#C0C0C0", dark: "#808080", light: "#E8E8E8" }; // éŠ€
                    case 3: return { main: "#FFD700", dark: "#B8860B", light: "#FFFACD" }; // é‡‘
                    case 4: return { main: "#E5E4E2", dark: "#A9A9A9", light: "#F5F5F5" }; // ç™½é‡‘
                    case 5: return { main: "#50C878", dark: "#006400", light: "#98FB98", ring: "#E5E4E2" }; // ç¿¡ç¿  (ç™½é‡‘åº•)
                    case 6: return { main: "#E0115F", dark: "#8B0000", light: "#FF69B4", ring: "#FFD700" }; // ç´…å¯¶ (é‡‘åº•)
                    case 7: return { main: "#0047AB", dark: "#00008B", light: "#4169E1", ring: "#FFD700" }; // è—é‘½ (é‡‘åº•)
                    case 8: return { main: "#FFD700", dark: "#B8860B", light: "#FFFFE0" }; // çç›ƒ
                    case 9: return { main: "#FFD700", dark: "#DAA520", light: "#FFFFF0", gem: "#E0115F" }; // çš‡å† 
                    default: return { main: "#888", dark: "#444", light: "#ccc" };
                }
            };

            const colors = getColors(level);

            // å®šç¾©æ¿¾é¡ (é‡‘å±¬å…‰æ¾¤)
            const defs = (
                <defs>
                    <linearGradient id={`grad-${level}`} x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stopColor={colors.light} />
                        <stop offset="50%" stopColor={colors.main} />
                        <stop offset="100%" stopColor={colors.dark} />
                    </linearGradient>
                    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur stdDeviation="2" result="blur" />
                        <feComposite in="SourceGraphic" in2="blur" operator="over" />
                    </filter>
                </defs>
            );

            // 1. åŸºç¤æˆ’æŒ‡ SVG
            if (level <= 4) {
                return (
                    <svg viewBox="0 0 100 100" className={className} filter="drop-shadow(2px 4px 6px rgba(0,0,0,0.3))">
                        {defs}
                        <circle cx="50" cy="50" r="35" fill="none" stroke={`url(#grad-${level})`} strokeWidth="12" />
                        <circle cx="50" cy="50" r="35" fill="none" stroke="rgba(255,255,255,0.4)" strokeWidth="2" strokeDasharray="10 5" opacity="0.5" />
                        {/* äº®é» */}
                        <circle cx="25" cy="25" r="4" fill="white" opacity="0.8" />
                    </svg>
                );
            }

            // 2. å¯¶çŸ³æˆ’æŒ‡ SVG
            if (level <= 7) {
                return (
                    <svg viewBox="0 0 100 100" className={className} filter="drop-shadow(2px 4px 6px rgba(0,0,0,0.3))">
                        {defs}
                        {/* æˆ’å° */}
                        <circle cx="50" cy="55" r="30" fill="none" stroke={colors.ring || colors.main} strokeWidth="10" />
                        {/* å¯¶çŸ³åº•åº§ */}
                        <path d="M35 30 L65 30 L50 55 Z" fill={colors.dark} />
                        {/* å¯¶çŸ³æœ¬é«” */}
                        <path d="M50 10 L70 30 L50 50 L30 30 Z" fill={`url(#grad-${level})`} stroke={colors.light} strokeWidth="1" />
                        <path d="M50 10 L70 30 L50 50 L30 30 Z" fill="url(#grad-level)" opacity="0.3" />
                        {/* é–ƒå…‰ */}
                        <path d="M45 25 L50 15 L55 25 L50 35 Z" fill="white" opacity="0.6" />
                    </svg>
                );
            }

            // 3. çç›ƒ (Lv 8)
            if (level === 8) {
                return (
                    <svg viewBox="0 0 100 100" className={className} filter="drop-shadow(2px 4px 6px rgba(0,0,0,0.3))">
                        {defs}
                        <path d="M30 20 L70 20 L65 60 C65 75 35 75 35 60 Z" fill={`url(#grad-${level})`} stroke={colors.dark} strokeWidth="2" />
                        <path d="M30 25 C20 25 20 50 32 50" fill="none" stroke={`url(#grad-${level})`} strokeWidth="5" />
                        <path d="M70 25 C80 25 80 50 68 50" fill="none" stroke={`url(#grad-${level})`} strokeWidth="5" />
                        <rect x="35" y="75" width="30" height="5" fill={colors.dark} />
                        <path d="M30 80 L70 80 L75 90 L25 90 Z" fill={colors.main} />
                        <circle cx="50" cy="40" r="8" fill={colors.light} opacity="0.4" />
                    </svg>
                );
            }

            // 4. çš‡å†  (Lv 9)
            if (level === 9) {
                return (
                    <svg viewBox="0 0 100 100" className={className} filter="drop-shadow(2px 4px 6px rgba(0,0,0,0.3))">
                        {defs}
                        {/* çš‡å† åº•åº§ */}
                        <path d="M20 70 L80 70 L75 90 L25 90 Z" fill={colors.dark} />
                        {/* çš‡å† ä¸»é«” */}
                        <path d="M20 70 L20 40 L35 60 L50 20 L65 60 L80 40 L80 70 Z" fill={`url(#grad-${level})`} stroke={colors.light} strokeWidth="2" />
                        {/* å¯¶çŸ³ */}
                        <circle cx="50" cy="80" r="5" fill={colors.gem} stroke="white" strokeWidth="1" />
                        <circle cx="20" cy="40" r="3" fill={colors.gem} />
                        <circle cx="50" cy="20" r="4" fill={colors.gem} />
                        <circle cx="80" cy="40" r="3" fill={colors.gem} />
                    </svg>
                );
            }
            return null;
        };


        // --- Simple Icons ---
        const IconRefresh = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500 mb-2 animate-bounce"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-500 mb-2 animate-pulse"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>;
        const IconAward = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>;
        const IconBook = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const IconBomb = ({ shaking }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill={shaking ? "#ef4444" : "#1e293b"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={shaking ? "shake-hard" : ""}>
                <circle cx="11" cy="13" r="9"></circle>
                <path d="M11 4a3 3 0 0 1 2.23-5"></path>
                <path d="M14.5 7.5 18 4"></path>
            </svg>
        );
        const IconHome = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>;
        const IconTrophy = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-yellow-500"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17"></path><path d="M14 14.66V17"></path><path d="M18 2h-6c-1.66 0-3 1.34-3 3v4.66c0 3.32 2.68 6 6 6s6-2.68 6-6V5c0-1.66-1.34-3-3-3z"></path></svg>;
        const IconHeart = ({ filled }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill={filled ? "#ef4444" : "none"} stroke={filled ? "#ef4444" : "#cbd5e1"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        );

        // é—œå¡è¨­å®š (æ›´æ–°ï¼šå»é™¤ emojiï¼Œæ”¹ç”¨ Icon)
        const LEVELS = [
            { level: 1, type: "symbolic", time: 10, allowMistakes: 3, resetTo: 0, name: "æ–°æ‰‹å…¥é–€", badge: "éŠ…ç’°" },
            { level: 2, type: "symbolic", time: 10, allowMistakes: 3, resetTo: 0, name: "åˆè©¦å•¼è²", badge: "éŠ€ç’°" },
            { level: 3, type: "symbolic", time: 10, allowMistakes: 3, resetTo: 0, name: "ç¬¦è™Ÿå¤§å¸«", badge: "é‡‘ç’°" },
            
            { level: 4, type: "numeric", time: 7, allowMistakes: 2, resetTo: 3, name: "æ•¸å€¼è¨ˆç®—", badge: "ç™½é‡‘ç’°" },
            { level: 5, type: "numeric", time: 7, allowMistakes: 2, resetTo: 3, name: "ç²¾æº–æ‰“æ“Š", badge: "ç¿¡ç¿ ç’°" },
            { level: 6, type: "numeric", time: 7, allowMistakes: 2, resetTo: 3, name: "ç¥ç®—å­", badge: "ç´…å¯¶çŸ³ç’°" },
            
            { level: 7, type: "mixed", time: 5, allowMistakes: 0, resetTo: 6, name: "èæœƒè²«é€š", badge: "è—é‘½ç’°" },
            { level: 8, type: "mixed", time: 5, allowMistakes: 0, resetTo: 6, name: "ç™»å³°é€ æ¥µ", badge: "å¤§å¸«çç›ƒ" },
            { level: 9, type: "mixed", time: 5, allowMistakes: 0, resetTo: 6, name: "å‚³å¥‡èª•ç”Ÿ", badge: "ç’€ç’¨çš‡å† " },
        ];

        // é¡Œç›®è³‡æ–™ (ç¶­æŒä¸è®Š)
        const SYMBOLIC_QUESTIONS = [
            { q: "\\sin(-\\theta)", a: "-\\sin \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\cos(-\\theta)", a: "\\cos \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\tan(-\\theta)", a: "-\\tan \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\sin(180^\\circ - \\theta)", a: "\\sin \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\cos(180^\\circ - \\theta)", a: "-\\cos \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\tan(180^\\circ - \\theta)", a: "-\\tan \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\sin(180^\\circ + \\theta)", a: "-\\sin \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\cos(180^\\circ + \\theta)", a: "-\\cos \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\tan(180^\\circ + \\theta)", a: "\\tan \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\sin(360^\\circ - \\theta)", a: "-\\sin \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\cos(360^\\circ - \\theta)", a: "\\cos \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\tan(360^\\circ - \\theta)", a: "-\\tan \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\sin(90^\\circ + \\theta)", a: "\\cos \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\cos(90^\\circ + \\theta)", a: "-\\sin \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\sin(270^\\circ - \\theta)", a: "-\\cos \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\cos(270^\\circ - \\theta)", a: "-\\sin \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\sin(270^\\circ + \\theta)", a: "-\\cos \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
            { q: "\\cos(270^\\circ + \\theta)", a: "\\sin \\theta", type: "ç¬¦è™ŸåŒ–ç°¡" },
        ];

        const NUMERIC_QUESTIONS = [
            { q: "\\sin(120^\\circ)", a: "\\dfrac{\\sqrt{3}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(120^\\circ)", a: "-\\dfrac{1}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(120^\\circ)", a: "-\\sqrt{3}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(135^\\circ)", a: "\\dfrac{\\sqrt{2}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(135^\\circ)", a: "-\\dfrac{\\sqrt{2}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(135^\\circ)", a: "-1", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(150^\\circ)", a: "\\dfrac{1}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(150^\\circ)", a: "-\\dfrac{\\sqrt{3}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(150^\\circ)", a: "-\\dfrac{1}{\\sqrt{3}}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(210^\\circ)", a: "-\\dfrac{1}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(210^\\circ)", a: "-\\dfrac{\\sqrt{3}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(210^\\circ)", a: "\\dfrac{1}{\\sqrt{3}}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(225^\\circ)", a: "-\\dfrac{\\sqrt{2}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(225^\\circ)", a: "-\\dfrac{\\sqrt{2}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(225^\\circ)", a: "1", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(240^\\circ)", a: "-\\dfrac{\\sqrt{3}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(240^\\circ)", a: "-\\dfrac{1}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(240^\\circ)", a: "\\sqrt{3}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(300^\\circ)", a: "-\\dfrac{\\sqrt{3}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(300^\\circ)", a: "\\dfrac{1}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(300^\\circ)", a: "-\\sqrt{3}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(315^\\circ)", a: "-\\dfrac{\\sqrt{2}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(315^\\circ)", a: "\\dfrac{\\sqrt{2}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(315^\\circ)", a: "-1", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\sin(330^\\circ)", a: "-\\dfrac{1}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\cos(330^\\circ)", a: "\\dfrac{\\sqrt{3}}{2}", type: "æ•¸å€¼æ±‚å€¼" },
            { q: "\\tan(330^\\circ)", a: "-\\dfrac{1}{\\sqrt{3}}", type: "æ•¸å€¼æ±‚å€¼" },
        ];

        const SYMBOLIC_OPTION_POOL = [
            "\\sin \\theta", "-\\sin \\theta", "\\cos \\theta", "-\\cos \\theta", "\\tan \\theta", "-\\tan \\theta"
        ];
        const NUMERIC_VALUE_POOL = [
            "0", "1", "-1", "\\dfrac{1}{2}", "-\\dfrac{1}{2}", "\\dfrac{\\sqrt{2}}{2}", "-\\dfrac{\\sqrt{2}}{2}", 
            "\\dfrac{\\sqrt{3}}{2}", "-\\dfrac{\\sqrt{3}}{2}", "\\sqrt{3}", "-\\sqrt{3}", "\\dfrac{1}{\\sqrt{3}}", "-\\dfrac{1}{\\sqrt{3}}"
        ];

        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // --- å­é é¢ï¼šç·´ç¿’æ¨¡å¼ ---
        const PracticeMode = ({ onBack }) => {
            const [currentQuestion, setCurrentQuestion] = React.useState(null);
            const [currentOptions, setCurrentOptions] = React.useState([]);
            const [score, setScore] = React.useState(0);
            const [streak, setStreak] = React.useState(0);
            const [feedback, setFeedback] = React.useState(null);
            const [showCheatSheet, setShowCheatSheet] = React.useState(false);

            const allQuestions = [...SYMBOLIC_QUESTIONS, ...NUMERIC_QUESTIONS];

            const generateQuestion = () => {
                let randomIndex;
                let newQuestion;
                do {
                    randomIndex = Math.floor(Math.random() * allQuestions.length);
                    newQuestion = allQuestions[randomIndex];
                } while (allQuestions.length > 1 && currentQuestion && newQuestion.q === currentQuestion.q);

                setCurrentQuestion(newQuestion);
                setFeedback(null);

                const correctAnswer = newQuestion.a;
                const pool = newQuestion.type === "ç¬¦è™ŸåŒ–ç°¡" ? SYMBOLIC_OPTION_POOL : NUMERIC_VALUE_POOL;
                const distractors = pool.filter(val => val !== correctAnswer).sort(() => 0.5 - Math.random()).slice(0, 3);
                setCurrentOptions(shuffleArray([...distractors, correctAnswer]));
            };

            React.useEffect(() => { generateQuestion(); }, []);

            const handleAnswer = (val) => {
                if (feedback) return;
                if (val === currentQuestion.a) {
                    setScore(score + 10);
                    setStreak(streak + 1);
                    setFeedback('correct');
                } else {
                    setStreak(0);
                    setFeedback('incorrect');
                }
                setTimeout(generateQuestion, 1500);
            };

            return (
                <div className="w-full max-w-md mx-auto">
                    <div className="flex justify-between items-center mb-4">
                         <button onClick={onBack} className="flex items-center gap-1 text-slate-500 hover:text-blue-600 font-bold">
                            <IconHome /> è¿”å›ä¸»é¸å–®
                        </button>
                        <div className="flex items-center gap-2 bg-white px-3 py-1 rounded-full shadow-sm border border-slate-200">
                             <div className="text-xs font-bold text-slate-400">ç·´ç¿’æ¨¡å¼</div>
                        </div>
                    </div>

                    <div className="w-full bg-white rounded-2xl shadow-sm p-4 mb-6 flex justify-between items-center border border-slate-200">
                        <div className="flex flex-col">
                            <span className="text-xs text-slate-500 uppercase tracking-wider font-bold">ç›®å‰åˆ†æ•¸</span>
                            <span className="text-2xl font-black text-blue-600">{score}</span>
                        </div>
                        <div className="flex flex-col items-end">
                            <div className="flex items-center gap-1 text-orange-500">
                                <IconAward />
                                <span className="text-xs font-bold uppercase">é€£å°</span>
                            </div>
                            <span className="text-2xl font-black text-orange-500">{streak}</span>
                        </div>
                    </div>

                    <div className="w-full bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-200 relative select-none">
                         <div className="h-2 bg-slate-100 w-full">
                            <div className="h-full bg-blue-500 transition-all duration-500 ease-out" style={{ width: `${Math.min((streak / 10) * 100, 100)}%` }} />
                        </div>
                        <div className="p-8 text-center min-h-[220px] flex flex-col items-center justify-center">
                            <span className={`text-sm font-medium mb-3 px-3 py-1 rounded-full ${currentQuestion?.type === 'æ•¸å€¼æ±‚å€¼' ? 'bg-indigo-100 text-indigo-600' : 'bg-slate-100 text-slate-500'}`}>
                                {currentQuestion?.type}
                            </span>
                            <div className="text-4xl sm:text-5xl font-black text-slate-800 tracking-tight my-4">
                                {currentQuestion && <Latex>{currentQuestion.q}</Latex>}
                            </div>
                            <p className="text-slate-400 text-sm">è«‹é¸æ“‡æ­£ç¢ºçš„ç­”æ¡ˆ</p>
                        </div>
                         {feedback && (
                            <div className={`absolute inset-0 flex flex-col items-center justify-center z-10 backdrop-blur-sm bg-opacity-90 transition-all duration-300 ${feedback === 'correct' ? 'bg-green-50/90' : 'bg-red-50/90'}`}>
                                {feedback === 'correct' ? (
                                    <>
                                        <IconCheck />
                                        <h2 className="text-2xl font-bold text-green-700">ç­”å°äº†ï¼</h2>
                                        <div className="text-green-600 font-medium text-xl mt-2 flex items-center gap-2">
                                            <Latex>{currentQuestion.q}</Latex> <span>=</span> <Latex>{currentQuestion.a}</Latex>
                                        </div>
                                    </>
                                ) : (
                                    <>
                                        <IconX />
                                        <h2 className="text-2xl font-bold text-red-700">ç­”éŒ¯äº†</h2>
                                        <p className="text-slate-600 mt-2">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</p>
                                        <div className="text-2xl font-bold text-slate-800 mt-1"><Latex>{currentQuestion.a}</Latex></div>
                                    </>
                                )}
                            </div>
                        )}
                    </div>

                    <div className="grid grid-cols-2 gap-3 mt-6">
                        {currentOptions.map((opt, i) => (
                            <button key={i} onClick={() => handleAnswer(opt)} disabled={feedback !== null}
                                className={`btn-option p-4 rounded-xl text-xl font-bold transition-all duration-200 shadow-sm border flex items-center justify-center min-h-[80px] ${feedback === null ? 'bg-white hover:bg-blue-50 hover:border-blue-300 border-slate-200 text-slate-700' : 'bg-slate-100 text-slate-300 border-slate-100'}`}>
                                <Latex>{opt}</Latex>
                            </button>
                        ))}
                    </div>

                    <div className="mt-8 flex gap-4">
                        <button onClick={() => setShowCheatSheet(!showCheatSheet)} className="flex items-center gap-2 px-4 py-2 bg-white rounded-full text-slate-600 text-sm font-medium shadow-sm hover:bg-slate-50 border border-slate-200"><IconBook /> {showCheatSheet ? "éš±è—é‡é»" : "æŸ¥çœ‹é‡é»æ•´ç†"}</button>
                    </div>

                    {showCheatSheet && (
                        <div className="mt-4 bg-yellow-50 p-6 rounded-2xl border border-yellow-200 text-yellow-900 text-sm shadow-inner mb-8">
                             <h3 className="font-bold text-lg mb-3 flex items-center gap-2">ğŸ“Œ é‡é»ç­†è¨˜</h3>
                            <ul className="list-disc pl-4 space-y-1 text-yellow-800/80 mb-4">
                                <li><span className="font-semibold">å¥‡è®Šå¶ä¸è®Š</span>ï¼š<Latex>{"90^\\circ, 270^\\circ"}</Latex> è¦è®Šå‡½æ•¸ï¼›<Latex>{"180^\\circ, 360^\\circ"}</Latex> ä¸è®Šã€‚</li>
                                <li><span className="font-semibold">ç¬¦è™Ÿçœ‹è±¡é™</span>ï¼šçœ‹ã€ŒåŸå‡½æ•¸ã€åœ¨è©²è§’åº¦è±¡é™çš„æ­£è² è™Ÿã€‚</li>
                            </ul>
                            <div className="grid grid-cols-4 gap-2 text-center text-xs font-medium">
                                <div className="bg-yellow-100/50 p-1 rounded"></div><div className="bg-yellow-100/50 p-1 rounded"><Latex>{"30^\\circ"}</Latex></div><div className="bg-yellow-100/50 p-1 rounded"><Latex>{"45^\\circ"}</Latex></div><div className="bg-yellow-100/50 p-1 rounded"><Latex>{"60^\\circ"}</Latex></div>
                                <div className="bg-yellow-100/50 p-1 rounded text-left pl-2"><Latex>{"\\sin"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\dfrac{1}{2}"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\dfrac{\\sqrt{2}}{2}"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\dfrac{\\sqrt{3}}{2}"}</Latex></div>
                                <div className="bg-yellow-100/50 p-1 rounded text-left pl-2"><Latex>{"\\cos"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\dfrac{\\sqrt{3}}{2}"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\dfrac{\\sqrt{2}}{2}"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\dfrac{1}{2}"}</Latex></div>
                                <div className="bg-yellow-100/50 p-1 rounded text-left pl-2"><Latex>{"\\tan"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\dfrac{1}{\\sqrt{3}}"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"1"}</Latex></div><div className="bg-white p-1 rounded border border-yellow-100"><Latex>{"\\sqrt{3}"}</Latex></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- å­é é¢ï¼šé—–é—œæ¨¡å¼ ---
        const ChallengeMode = ({ onBack, onLevelComplete, initialLevelIdx }) => {
            const [levelIdx, setLevelIdx] = React.useState(initialLevelIdx || 0);
            const [questionIdx, setQuestionIdx] = React.useState(0);
            const [mistakeCount, setMistakeCount] = React.useState(0);
            const [gameState, setGameState] = React.useState('intro');
            const [timer, setTimer] = React.useState(0);
            const [currentQ, setCurrentQ] = React.useState(null);
            const [currentOpts, setCurrentOpts] = React.useState([]);
            
            const currentLevelConfig = LEVELS[levelIdx];
            const QUESTIONS_PER_LEVEL = 10;
            const timerRef = React.useRef(null);

            const startLevel = () => {
                setGameState('playing');
                setQuestionIdx(0);
                setMistakeCount(0);
                nextQuestion(true);
            };

            const nextQuestion = (isFirst = false) => {
                const config = LEVELS[levelIdx];
                let pool = [];
                if (config.type === 'symbolic') pool = SYMBOLIC_QUESTIONS;
                else if (config.type === 'numeric') pool = NUMERIC_QUESTIONS;
                else pool = [...SYMBOLIC_QUESTIONS, ...NUMERIC_QUESTIONS];

                const q = pool[Math.floor(Math.random() * pool.length)];
                setCurrentQ(q);

                const correctAnswer = q.a;
                const optPool = q.type === "ç¬¦è™ŸåŒ–ç°¡" ? SYMBOLIC_OPTION_POOL : NUMERIC_VALUE_POOL;
                const distractors = optPool.filter(val => val !== correctAnswer).sort(() => 0.5 - Math.random()).slice(0, 3);
                setCurrentOpts(shuffleArray([...distractors, correctAnswer]));

                // Reset Timer
                setTimer(config.time);
                if (timerRef.current) clearInterval(timerRef.current);
                
                timerRef.current = setInterval(() => {
                    setTimer(prev => {
                        if (prev <= 0.1) { 
                            clearInterval(timerRef.current);
                            handleMistake("timeout");
                            return 0;
                        }
                        return prev - 0.1;
                    });
                }, 100);
            };

            React.useEffect(() => {
                return () => { if (timerRef.current) clearInterval(timerRef.current); };
            }, []);

            const handleMistake = (reason) => {
                const newMistakes = mistakeCount + 1;
                setMistakeCount(newMistakes);

                if (newMistakes > currentLevelConfig.allowMistakes) {
                    clearInterval(timerRef.current);
                    setGameState('exploded');
                } else {
                    if (questionIdx + 1 >= QUESTIONS_PER_LEVEL) {
                        clearInterval(timerRef.current);
                        setGameState('won');
                        onLevelComplete(LEVELS[levelIdx]);
                    } else {
                        setQuestionIdx(prev => prev + 1);
                        nextQuestion();
                    }
                }
            };

            const handleAnswer = (val) => {
                if (gameState !== 'playing') return;
                
                if (val === currentQ.a) {
                    if (questionIdx + 1 >= QUESTIONS_PER_LEVEL) {
                        clearInterval(timerRef.current);
                        setGameState('won');
                        onLevelComplete(LEVELS[levelIdx]);
                    } else {
                        setQuestionIdx(prev => prev + 1);
                        nextQuestion();
                    }
                } else {
                    handleMistake("wrong");
                }
            };

            const retryLevel = () => {
                const targetLevelIdx = currentLevelConfig.resetTo;
                setLevelIdx(targetLevelIdx);
                setGameState('intro');
            };
            
            const nextLevel = () => {
                if (levelIdx + 1 < LEVELS.length) {
                    setLevelIdx(prev => prev + 1);
                    setGameState('intro');
                } else {
                    onBack(); 
                }
            };

            // Intro Screen
            if (gameState === 'intro') {
                const cfg = LEVELS[levelIdx];
                return (
                    <div className="w-full max-w-md mx-auto text-center pt-10">
                        <div className="mb-6 bg-white p-6 rounded-3xl shadow-lg border border-slate-200">
                            {/* Large GameBadge */}
                            <div className="flex justify-center mb-6">
                                <GameBadge level={cfg.level} className="w-24 h-24" />
                            </div>

                            <h2 className="text-3xl font-black text-slate-800 mb-2">ç¬¬ {cfg.level} é—œ</h2>
                            <h3 className="text-xl text-blue-600 font-bold mb-4">{cfg.name}</h3>
                            <div className="flex flex-col gap-3 mb-6 text-slate-600">
                                <div className="flex justify-between bg-slate-50 px-4 py-2 rounded-xl border border-slate-100">
                                    <span className="text-sm font-bold text-slate-400 uppercase">é™æ™‚</span>
                                    <span className="font-bold text-slate-800">{cfg.time} ç§’ / é¡Œ</span>
                                </div>
                                <div className="flex justify-between bg-slate-50 px-4 py-2 rounded-xl border border-slate-100">
                                    <span className="text-sm font-bold text-slate-400 uppercase">å®¹éŒ¯</span>
                                    <span className="font-bold text-red-500">
                                        {cfg.allowMistakes === 0 ? "ä¸€é¡Œå³æ­» (0å®¹éŒ¯)" : `å¯éŒ¯ ${cfg.allowMistakes} é¡Œ`}
                                    </span>
                                </div>
                                <div className="flex justify-between bg-slate-50 px-4 py-2 rounded-xl border border-slate-100">
                                    <span className="text-sm font-bold text-slate-400 uppercase">å¤±æ•—æ‡²ç½°</span>
                                    <span className="font-bold text-slate-800">
                                        {cfg.resetTo === levelIdx ? "é‡ä¾†æœ¬é—œ" : `é€€å›ç¬¬ ${LEVELS[cfg.resetTo].level} é—œ`}
                                    </span>
                                </div>
                            </div>
                            <div className="text-sm text-slate-400 mb-8">
                                é€£çºŒæŒ‘æˆ° 10 é¡Œï¼š<br/>
                                <span className="font-bold text-slate-600 mt-1 block text-lg">{cfg.badge}</span>
                            </div>
                            <button onClick={startLevel} className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold text-xl shadow-lg shadow-blue-200 transition-all active:scale-95">
                                é–‹å§‹æŒ‘æˆ°
                            </button>
                        </div>
                        <button onClick={onBack} className="text-slate-400 font-bold text-sm hover:text-slate-600">æ”¾æ£„æŒ‘æˆ°ï¼Œè¿”å›é¸å–®</button>
                    </div>
                );
            }

            // Game Over (Exploded)
            if (gameState === 'exploded') {
                return (
                    <div className="w-full max-w-md mx-auto text-center pt-10">
                        <div className="mb-6 bg-red-50 p-8 rounded-3xl border-2 border-red-100 relative overflow-hidden">
                            <div className="absolute inset-0 bg-red-500/10 explosion-effect"></div>
                            <div className="relative z-10">
                                <div className="text-6xl mb-4">ğŸ’¥</div>
                                <h2 className="text-3xl font-black text-red-600 mb-2">æŒ‘æˆ°å¤±æ•—</h2>
                                <p className="text-red-800 font-bold mb-2">éŒ¯èª¤æ¬¡æ•¸å·²é”ä¸Šé™ï¼</p>
                                <p className="text-slate-600 text-sm mb-6">ä¾è¦å‰‡ï¼Œæ‚¨å¿…é ˆé€€å› <span className="font-bold text-slate-800">ç¬¬ {LEVELS[currentLevelConfig.resetTo].level} é—œ</span> é‡æ–°ä¿®ç…‰ã€‚</p>
                                <button onClick={retryLevel} className="w-full py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-red-200 transition-all active:scale-95">
                                    æ¥å—æ‡²ç½°ï¼Œé‡æ–°é–‹å§‹
                                </button>
                            </div>
                        </div>
                        <button onClick={onBack} className="text-slate-400 font-bold text-sm hover:text-slate-600">è¿”å›é¸å–®</button>
                    </div>
                );
            }

            // Won Level
            if (gameState === 'won') {
                return (
                    <div className="w-full max-w-md mx-auto text-center pt-10">
                        <div className="mb-6 bg-yellow-50 p-8 rounded-3xl border-2 border-yellow-200">
                            <div className="flex justify-center mb-6">
                                <GameBadge level={currentLevelConfig.level} className="w-32 h-32 animate-bounce" />
                            </div>
                            <h2 className="text-2xl font-black text-yellow-700 mb-2">æŒ‘æˆ°æˆåŠŸï¼</h2>
                            <p className="text-yellow-800 mb-4">ç²å¾—å¾½ç« </p>
                            <div className="text-3xl font-bold text-yellow-900 mb-8 bg-white/50 py-2 rounded-lg">{currentLevelConfig.badge}</div>
                            
                            {levelIdx + 1 < LEVELS.length ? (
                                <button onClick={nextLevel} className="w-full py-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded-xl font-bold text-lg shadow-lg shadow-yellow-200 transition-all active:scale-95">
                                    ä¸‹ä¸€é—œï¼š{LEVELS[levelIdx+1].name}
                                </button>
                            ) : (
                                <div className="text-yellow-800 font-bold">æ­å–œä½ å®Œæˆæ‰€æœ‰æŒ‘æˆ°ï¼ä½ æ˜¯çœŸæ­£çš„ä¸‰è§’å‡½æ•¸å¤§å¸«ï¼</div>
                            )}
                        </div>
                        <button onClick={onBack} className="text-slate-400 font-bold text-sm hover:text-slate-600">è¿”å›é¸å–®</button>
                    </div>
                );
            }

            // Playing
            const isShaking = timer <= 2.5;
            const progress = ((questionIdx) / QUESTIONS_PER_LEVEL) * 100;
            const remainingAllowance = currentLevelConfig.allowMistakes - mistakeCount;

            return (
                <div className="w-full max-w-md mx-auto relative">
                     {/* Top Bar */}
                    <div className="flex justify-between items-center mb-4">
                         <div className="flex items-center gap-2">
                             <span className="bg-slate-800 text-white text-xs font-bold px-2 py-1 rounded">Lv.{currentLevelConfig.level}</span>
                             <div className="flex items-center gap-1">
                                {currentLevelConfig.allowMistakes === 0 ? (
                                    <span className="text-xs font-bold text-red-500 bg-red-100 px-2 py-0.5 rounded-full">ğŸ’€ ä¸€å‘½é€šé—œ</span>
                                ) : (
                                    <div className="flex gap-0.5">
                                        {[...Array(currentLevelConfig.allowMistakes)].map((_, i) => (
                                            <IconHeart key={i} filled={i < remainingAllowance} />
                                        ))}
                                    </div>
                                )}
                             </div>
                         </div>
                         <div className="text-xs font-bold text-slate-400">
                             ç¬¬ {questionIdx + 1} / {QUESTIONS_PER_LEVEL} é¡Œ
                         </div>
                    </div>

                    {/* Timer Bomb */}
                    <div className="flex justify-center mb-6">
                        <div className={`relative flex items-center justify-center w-20 h-20 rounded-full bg-slate-100 border-4 ${isShaking ? 'border-red-500 bg-red-50' : 'border-slate-200'}`}>
                            <IconBomb shaking={isShaking} />
                            <span className={`absolute -bottom-8 font-black text-2xl ${timer <= 2 ? 'text-red-600' : 'text-slate-700'}`}>
                                {timer.toFixed(1)}
                            </span>
                        </div>
                    </div>

                    {/* Question Card */}
                    <div className={`w-full bg-white rounded-3xl shadow-xl overflow-hidden border ${isShaking ? 'border-red-300' : 'border-slate-200'} relative select-none min-h-[220px] flex flex-col justify-center`}>
                        {/* Progress Bar */}
                        <div className="absolute top-0 left-0 w-full h-1.5 bg-slate-100">
                             <div className="h-full bg-green-500 transition-all duration-300" style={{ width: `${progress}%` }}></div>
                        </div>

                        <div className="p-8 text-center">
                            <div className="text-4xl sm:text-5xl font-black text-slate-800 tracking-tight my-4">
                                {currentQ && <Latex>{currentQ.q}</Latex>}
                            </div>
                        </div>
                    </div>

                    {/* Options */}
                    <div className="grid grid-cols-2 gap-3 mt-6">
                        {currentOpts.map((opt, i) => (
                            <button key={i} onClick={() => handleAnswer(opt)}
                                className="btn-option p-4 rounded-xl text-xl font-bold bg-white hover:bg-blue-50 hover:border-blue-300 border border-slate-200 text-slate-700 flex items-center justify-center min-h-[80px] shadow-sm active:scale-95 transition-all">
                                <Latex>{opt}</Latex>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- å­é é¢ï¼šæ’è¡Œæ¦œ ---
        const Leaderboard = ({ onBack, records }) => {
            return (
                <div className="w-full max-w-md mx-auto">
                    <div className="flex justify-between items-center mb-6">
                         <button onClick={onBack} className="flex items-center gap-1 text-slate-500 hover:text-blue-600 font-bold">
                            <IconHome /> è¿”å›ä¸»é¸å–®
                        </button>
                        <h2 className="text-xl font-black text-slate-800">æ¦®è­½æ¦œ</h2>
                    </div>

                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        {records.length === 0 ? (
                            <div className="p-8 text-center text-slate-400">
                                å°šæœªæœ‰é—–é—œç´€éŒ„ï¼Œå¿«å»æŒ‘æˆ°å§ï¼
                            </div>
                        ) : (
                            <div className="divide-y divide-slate-100">
                                {records.map((rec, i) => (
                                    <div key={i} className="p-4 flex items-center justify-between">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 flex items-center justify-center text-yellow-700 rounded-full font-bold text-sm">
                                                <GameBadge level={rec.level} className="w-full h-full" />
                                            </div>
                                            <div>
                                                <div className="font-bold text-slate-700">{rec.badge}</div>
                                                <div className="text-xs text-slate-400">{rec.date}</div>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-xs font-bold text-slate-400 uppercase">é€šé—œç­‰ç´š</div>
                                            <div className="font-black text-blue-600">Lv.{rec.level}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- ä¸»ç¨‹å¼ ---
        const App = () => {
            const [mode, setMode] = React.useState('menu'); // menu, practice, challenge, leaderboard
            const [records, setRecords] = React.useState([]);

            // Load records from local storage
            React.useEffect(() => {
                const saved = localStorage.getItem('trig_records');
                if (saved) setRecords(JSON.parse(saved));
            }, []);

            const saveRecord = (levelConfig) => {
                const newRecord = {
                    level: levelConfig.level,
                    badge: levelConfig.badge,
                    date: new Date().toLocaleDateString()
                };
                const newRecords = [newRecord, ...records].slice(0, 20); 
                newRecords.sort((a, b) => b.level - a.level);
                
                setRecords(newRecords);
                localStorage.setItem('trig_records', JSON.stringify(newRecords));
            };

            const renderContent = () => {
                switch(mode) {
                    case 'practice':
                        return <PracticeMode onBack={() => setMode('menu')} />;
                    case 'challenge':
                        return <ChallengeMode onBack={() => setMode('menu')} onLevelComplete={saveRecord} />;
                    case 'leaderboard':
                        return <Leaderboard onBack={() => setMode('menu')} records={records} />;
                    default: // menu
                        return (
                            <div className="w-full max-w-md mx-auto flex flex-col items-center justify-center min-h-[80vh] gap-6">
                                <div className="text-center mb-4">
                                    <h1 className="text-4xl font-black text-slate-800 tracking-tight mb-2">ä¸‰è§’å‡½æ•¸å¤§å¸«</h1>
                                    <p className="text-slate-500 font-medium">èª˜å°å…¬å¼ & ç‰¹åˆ¥è§’æ•¸å€¼ç‰¹è¨“</p>
                                </div>

                                <button onClick={() => setMode('challenge')} className="w-full py-6 bg-gradient-to-r from-red-500 to-orange-500 text-white rounded-2xl shadow-lg shadow-orange-200 flex flex-col items-center justify-center gap-2 transform transition hover:scale-105 active:scale-95 group">
                                    <div className="flex items-center gap-2">
                                        <span className="text-3xl group-hover:animate-bounce">ğŸ”¥</span>
                                        <span className="text-2xl font-black">é—–é—œæ¨¡å¼</span>
                                    </div>
                                    <span className="text-white/80 text-sm font-bold">é™æ™‚ç‚¸å½ˆæŒ‘æˆ°ãƒ»çˆ­å¥ªçš‡å† </span>
                                </button>

                                <button onClick={() => setMode('practice')} className="w-full py-5 bg-white border-2 border-slate-200 text-slate-700 rounded-2xl shadow-sm hover:border-blue-400 hover:text-blue-600 flex flex-col items-center justify-center gap-1 transition-all active:scale-95">
                                    <div className="flex items-center gap-2">
                                        <span className="text-2xl">ğŸ“–</span>
                                        <span className="text-xl font-bold">ç·´ç¿’æ¨¡å¼</span>
                                    </div>
                                    <span className="text-slate-400 text-xs">ç„¡æ™‚é–“é™åˆ¶ãƒ»é™„é‡é»ç­†è¨˜</span>
                                </button>

                                <button onClick={() => setMode('leaderboard')} className="flex items-center gap-2 text-slate-400 font-bold hover:text-slate-600 transition-colors mt-4">
                                    <IconTrophy /> æŸ¥çœ‹æ’è¡Œæ¦œ
                                </button>
                                
                                <div className="mt-8 text-xs text-slate-300 text-center">
                                    v3.0 SVG Badges Update
                                </div>
                            </div>
                        );
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 p-4 font-sans">
                    {renderContent()}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
